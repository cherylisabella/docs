<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best Practices - leakr</title>
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="../../index.html" class="nav-brand home-icon">
                <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z"/>
                </svg>
            </a>
            <div class="nav-links">
                <a href="https://github.com/cherylisabella" target="_blank" class="github-icon">
                    <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="doc-layout">
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <h3>leakr</h3>
                    <ul>
                        <li><a href="index.html">Overview</a></li>
                        <li><a href="core_functions.html">Core Functions</a></li>
                        <li><a href="data_io.html">Data Import/Export</a></li>
                        <li><a href="ml_integration.html">ML Framework Integration</a></li>
                        <li><a href="snapshots.html">Data Snapshots</a></li>
                        <li><a href="examples.html">Real-World Examples</a></li>
                        <li><a href="custom_detectors.html">Custom Detectors</a></li>
                        <li><a href="best_practices.html" class="active">Best Practices</a></li>
                    </ul>
                </nav>
            </aside>

            <main class="doc-content">
                <header class="doc-page-header">
                    <div class="header-title">
                        <h1>Best Practices</h1> </div>
                        <p>Effective strategies for using <code>leakr</code> to prevent data leakage and ensure reproducibility.</p>
                </header>

                <section>
                    <h2>1. Run Audits Early and Often</h2>
                    <pre class="code-block">
# ✓ Good: Audit immediately after data splitting
data$split <- create_split(data)
report <- leakr_audit(data, target = "outcome", split = "split")

# ✗ Bad: Audit after feature engineering and model training
                    </pre>
                </section>

                <section>
                    <h2>2. Always Specify ID Columns</h2>
                    <pre class="code-block">
# ✓ Good: Use unique identifiers when available
report <- leakr_audit(
  data = customer_data,
  target = "churn",
  split = "split",
  id = "customer_id"  # Explicit ID
)

# ✗ Bad: Rely on row hashing when IDs exist
report <- leakr_audit(
  data = customer_data,
  target = "churn",
  split = "split"
  # Missing id parameter
)
                    </pre>
                </section>

                <section>
                    <h2>3. Configure Appropriate Thresholds</h2>
                    <pre class="code-block">
# For financial/healthcare: Strict thresholds
report <- leakr_audit(
  data = medical_data,
  target = "diagnosis",
  config = list(
    correlation_threshold = 0.7,
    contamination_threshold = 0.01
  )
)

# For exploratory analysis: Lenient thresholds
report <- leakr_audit(
  data = exploration_data,
  target = "outcome",
  config = list(
    correlation_threshold = 0.95,
    contamination_threshold = 0.1
  )
)
                    </pre>
                </section>

                <section>
                    <h2>4. Review Evidence, Not Just Summaries</h2>
                    <pre class="code-block">
report <- leakr_audit(data, target = "outcome", split = "split", id = "id")

# Don't just look at summary
print(report$summary)

# ✓ Examine detailed evidence
report$evidence$train_test_contamination$overlap_ids
report$evidence$temporal$leakage_indices
report$evidence$duplication_detection$exact_duplicates
                    </pre>
                </section>

                <section>
                    <h2>5. Use Snapshots for Reproducibility</h2>
                    <pre class="code-block">
# Before any analysis
snapshot_path <- leakr_create_snapshot(
  raw_data,
  snapshot_name = "raw_data_v1",
  metadata = list(source = "production_db", date = Sys.Date())
)

# After preprocessing
snapshot_path <- leakr_create_snapshot(
  clean_data,
  snapshot_name = "clean_data_v1",
  metadata = list(preprocessing = "removed nulls, normalized")
)

# Before modeling
snapshot_path <- leakr_create_snapshot(
  model_ready_data,
  snapshot_name = "model_ready_v1",
  metadata = list(audit_passed = TRUE, issues = 0)
)
                    </pre>
                </section>

                <section>
                    <h2>6. Document Leakage Checks</h2>
                    <pre class="code-block">
# Export detailed report
leakr_export_data(report$summary, "audit_report.csv")

# Save configuration for reproducibility
config_used <- report$meta$config_used
saveRDS(config_used, "audit_config.rds")

# Create audit log
audit_log <- data.frame(
  timestamp = report$meta$timestamp,
  n_detectors = report$meta$n_detectors,
  n_issues = report$meta$n_issues,
  critical_issues = sum(report$summary$severity == "critical"),
  high_issues = sum(report$summary$severity == "high"),
  data_shape = paste(report$meta$data_shape, collapse = "x")
)
write.csv(audit_log, "audit_log.csv", row.names = FALSE)
                    </pre>
                </section>

                <section>
                    <h2>7. Integrate into CI/CD</h2>
                    <pre class="code-block">
# In your testing script
test_that("no data leakage in production pipeline", {
  data <- load_production_data()
  
  report <- leakr_audit(
    data = data,
    target = "target_var",
    split = "split",
    id = "id",
    config = list(
      correlation_threshold = 0.85,
      contamination_threshold = 0.05
    )
  )
  
  # Fail test if critical issues found
  critical_count <- sum(report$summary$severity == "critical")
  expect_equal(critical_count, 0, 
               info = paste("Found", critical_count, "critical leakage issues"))
})
                    </pre>
                </section>

                <section>
                    <h2>8. Handle Temporal Data Carefully</h2>
                    <pre class="code-block">
# ✓ Good: Proper temporal validation
detector <- new_temporal_detector(
  time_col = "date",
  lookahead_window = 30  # Allow 30-day gap
)

result <- run_detector(
  detector,
  timeseries_data,
  split = timeseries_data$split
)

# Verify temporal ordering
max_train <- max(timeseries_data$date[timeseries_data$split == "train"])
min_test <- min(timeseries_data$date[timeseries_data$split == "test"])
stopifnot(min_test > max_train)
                    </pre>
                </section>

                <section>
                    <h2>Troubleshooting</h2>
                    <h3>Q: Why is my audit showing no issues when I know there's leakage?</h3>
                    <pre class="code-block">
# 1. Verify split labels
table(data$split)  # Should show "train" and "test"

# 2. Check if target is specified
report <- leakr_audit(data, target = "outcome")  # Don't forget target!

# 3. Lower thresholds for more sensitivity
report <- leakr_audit(
  data,
  target = "outcome",
  config = list(
    correlation_threshold = 0.7,      # Lower = more sensitive
    contamination_threshold = 0.05
  )
)

# 4. Ensure ID column is correct
names(data)  # Verify column names
report <- leakr_audit(data, id = "correct_id_column")
                    </pre>
                    <h3>Q: How do I interpret severity scores?</h3>
                    <pre class="code-block">
# Severity levels indicate risk:
report$summary$severity_score
# 4 = critical: Immediate action required
# 3 = high: Address before production
# 2 = medium: Investigate and monitor
# 1 = low: Minor issue or false positive

# Filter by severity
critical <- report$summary[report$summary$severity_score >= 4, ]
actionable <- report$summary[report$summary$severity_score >= 3, ]
                    </pre>
                </section>
            </main>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 leakr. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
